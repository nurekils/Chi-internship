Docker Storage Notes — Volumes, Bind Mounts, tmpfs

1) Почему данные в контейнере пропадают
Файлы, которые создаются внутри контейнера без монтирования, лежат в writable layer контейнера.
Когда контейнер удаляется, этот слой исчезает вместе с данными. Поэтому для баз данных и любых
важных данных нужны внешние механизмы хранения.

2) Volumes (Docker volumes)
Volume — это специальный механизм Docker для хранения данных вне контейнера.
Docker сам управляет тем, где физически лежат эти данные на хосте.
Плюсы:
- проще бэкапить и переносить
- можно безопасно шарить между несколькими контейнерами
- лучше подходит для продакшена, особенно для БД
- не зависит от точного пути на хосте (Docker сам выбирает место)
Минусы:
- “не видно” как обычная папка (хотя можно посмотреть через docker volume inspect)

В docker-compose.yml volumes используются в двух местах:
A) внутри service -> volumes:
   это “подключение” (использование) тома к контейнеру:
     - postgres_data:/var/lib/postgresql/data
B) в корне файла -> volumes:
   это “объявление” (создание/описание) тома:
     volumes:
       postgres_data:
Зачем два раза:
- в сервисе ты говоришь: “подключи том postgres_data сюда, в контейнер по пути ...”
- внизу ты говоришь: “этот том должен существовать (создай его, если нет)”
Один том можно подключать к нескольким сервисам.

3) Bind mounts (bind mount)
Bind mount — это когда ты монтируешь конкретную папку/файл с хоста прямо в контейнер.
Пример в docker-compose:
  - ./app:/app
То есть Docker НЕ управляет местом хранения — ты явно задаёшь путь на хосте.
Плюсы:
- удобно для разработки (hot reload, редактируешь код на хосте, в контейнере сразу видно)
- просто понять где лежат файлы (обычная папка)
Минусы:
- сильная зависимость от путей и ОС (на другом компе путь может отличаться)
- можно случайно затереть файлы внутри контейнера
- на проде чаще используют volumes, чтобы не привязываться к структуре хоста

4) tmpfs mount
tmpfs — это временная файловая система в оперативной памяти.
Данные не пишутся на диск и исчезают при остановке контейнера.
Используется для:
- секретов/временных файлов
- повышения скорости для кэша
Минус: данные не сохраняются.

5) Короткое правило выбора
- Для продакшена и данных БД: чаще volume
- Для разработки и кода: чаще bind mount
- Для временных данных/секретов: tmpfs